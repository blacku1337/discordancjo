--[[
    Resource: OURGame v2
    Developers: Split <split.programista@gmail.com>
    You have no right to use this code without my permission.
    (c) 2015 <split.programista@gmail.com>. All rights reserved.
]]

local licenseBlip
local licenseTarget
local licenseMarker
local licenseVehicle
local licenseCategory

local categoryPositions={
	["A"]={
{953.49, -1367.05, 13.12},
{953.88, -1391.03, 13.11},
{989.99, -1402.46, 12.80},
{1061.56, -1402.90, 13.23},
{1148.71, -1402.93, 13.31},
{1241.47, -1407.98, 12.76},
{1317.21, -1408.04, 13.06},
{1339.67, -1426.04, 13.15},
{1324.21, -1487.74, 13.15},
{1295.71, -1570.76, 13.15},
{1295.30, -1675.75, 13.15},
{1294.72, -1790.62, 13.15},
{1297.00, -1846.54, 13.15},
{1310.36, -1822.48, 13.15},
{1310.23, -1750.58, 13.15},
{1310.09, -1680.06, 13.14},
{1309.91, -1585.90, 13.15},
{1338.70, -1491.43, 13.15},
{1355.11, -1403.47, 13.06},
{1355.32, -1322.91, 13.16},
{1355.30, -1245.66, 13.16},
{1355.30, -1166.74, 23.51},
{1341.57, -1158.64, 23.45},
{1340.11, -1224.03, 14.21},
{1335.10, -1276.64, 13.15},
{1280.00, -1278.54, 13.09},
{1193.72, -1278.56, 13.10},
{1101.81, -1278.11, 13.24},
{1055.31, -1297.80, 13.33},
{1057.02, -1360.61, 13.15},
{1035.20, -1393.64, 13.04},
{972.55, -1393.40, 12.77},
{919.37, -1385.60, 13.04},
{919.81, -1336.13, 13.17},
{870.85, -1319.95, 13.32},
{802.67, -1320.42, 13.13},
{794.86, -1367.59, 13.15},
{824.70, -1405.36, 13.13},
{895.73, -1407.85, 12.86},
{915.06, -1433.92, 13.08},
{920.81, -1487.65, 13.14},
{958.25, -1478.63, 13.30},
{958.46, -1450.92, 13.25},
	},
	["C"]={
{953.49, -1367.05, 13.12},
{953.88, -1391.03, 13.11},
{989.99, -1402.46, 12.80},
{1061.56, -1402.90, 13.23},
{1148.71, -1402.93, 13.31},
{1241.47, -1407.98, 12.76},
{1317.21, -1408.04, 13.06},
{1339.67, -1426.04, 13.15},
{1324.21, -1487.74, 13.15},
{1295.71, -1570.76, 13.15},
{1295.30, -1675.75, 13.15},
{1294.72, -1790.62, 13.15},
{1297.00, -1846.54, 13.15},
{1310.36, -1822.48, 13.15},
{1310.23, -1750.58, 13.15},
{1310.09, -1680.06, 13.14},
{1309.91, -1585.90, 13.15},
{1338.70, -1491.43, 13.15},
{1355.11, -1403.47, 13.06},
{1355.32, -1322.91, 13.16},
{1355.30, -1245.66, 13.16},
{1355.30, -1166.74, 23.51},
{1341.57, -1158.64, 23.45},
{1340.11, -1224.03, 14.21},
{1335.10, -1276.64, 13.15},
{1280.00, -1278.54, 13.09},
{1193.72, -1278.56, 13.10},
{1101.81, -1278.11, 13.24},
{1055.31, -1297.80, 13.33},
{1057.02, -1360.61, 13.15},
{1035.20, -1393.64, 13.04},
{972.55, -1393.40, 12.77},
{919.37, -1385.60, 13.04},
{919.81, -1336.13, 13.17},
{870.85, -1319.95, 13.32},
{802.67, -1320.42, 13.13},
{794.86, -1367.59, 13.15},
{824.70, -1405.36, 13.13},
{895.73, -1407.85, 12.86},
{915.06, -1433.92, 13.08},
{920.81, -1487.65, 13.14},
{958.25, -1478.63, 13.30},
{958.46, -1450.92, 13.25},
	},
	["B"]={
{953.49, -1367.05, 13.12},
{953.88, -1391.03, 13.11},
{989.99, -1402.46, 12.80},
{1061.56, -1402.90, 13.23},
{1148.71, -1402.93, 13.31},
{1241.47, -1407.98, 12.76},
{1317.21, -1408.04, 13.06},
{1339.67, -1426.04, 13.15},
{1324.21, -1487.74, 13.15},
{1295.71, -1570.76, 13.15},
{1295.30, -1675.75, 13.15},
{1294.72, -1790.62, 13.15},
{1297.00, -1846.54, 13.15},
{1310.36, -1822.48, 13.15},
{1310.23, -1750.58, 13.15},
{1310.09, -1680.06, 13.14},
{1309.91, -1585.90, 13.15},
{1338.70, -1491.43, 13.15},
{1355.11, -1403.47, 13.06},
{1355.32, -1322.91, 13.16},
{1355.30, -1245.66, 13.16},
{1355.30, -1166.74, 23.51},
{1341.57, -1158.64, 23.45},
{1340.11, -1224.03, 14.21},
{1335.10, -1276.64, 13.15},
{1280.00, -1278.54, 13.09},
{1193.72, -1278.56, 13.10},
{1101.81, -1278.11, 13.24},
{1055.31, -1297.80, 13.33},
{1057.02, -1360.61, 13.15},
{1035.20, -1393.64, 13.04},
{972.55, -1393.40, 12.77},
{919.37, -1385.60, 13.04},
{919.81, -1336.13, 13.17},
{870.85, -1319.95, 13.32},
{802.67, -1320.42, 13.13},
{794.86, -1367.59, 13.15},
{824.70, -1405.36, 13.13},
{895.73, -1407.85, 12.86},
{915.06, -1433.92, 13.08},
{920.81, -1487.65, 13.14},
{958.25, -1478.63, 13.30},
{958.46, -1450.92, 13.25},
 		
	},
	["L"]={
{1476.62, 1350.92, 11.22},
{1476.60, 1413.08, 11.31},
{1475.73, 1501.99, 19.38},
{1474.72, 1605.40, 31.95},
{1473.61, 1707.58, 47.63},
{1468.18, 1784.79, 75.65},
{1428.93, 1859.00, 97.06},
{1355.69, 1988.03, 115.49},
{1315.04, 2076.32, 133.67},
{1352.73, 2261.55, 154.04},
{1613.72, 2288.07, 213.03},
{1709.35, 2290.81, 240.55},
{1885.62, 2308.74, 271.07},
{2030.95, 2218.07, 307.75},
{2073.32, 2074.00, 344.56},
{2080.80, 1946.97, 352.90},
{2093.80, 1766.56, 332.95},
{2106.03, 1582.90, 340.91},
{2092.31, 1453.90, 338.75},
{2060.08, 1347.43, 311.79},
{1990.80, 1178.15, 252.37},
{1848.98, 910.67, 177.94},
{1699.64, 781.34, 177.32},
{1580.85, 978.75, 118.24},
{1522.91, 1096.78, 81.51},
{1498.14, 1198.22, 57.33},
{1475.85, 1356.45, 23.41},
{1474.66, 1413.14, 11.29},
{1474.56, 1459.73, 11.23},
{1442.64, 1527.53, 11.23},
	},
	["T"]={
		{-2003.43,438.75,35.02},
		{-2003.63, 380.51, 35.50},
		{-2003.63, 348.35, 35.50},
		{-2003.76, 303.06, 35.29},
		{-2005.54, 250.22, 30.41},
		{-2006.50, 194.44, 28.00},
		{-2006.50, 128.62, 28.00},
		{-2006.54, 52.03, 31.28},
		{-2062.99, 30.38, 35.62},
		{-2136.52, 30.39, 35.62},
		{-2166.63, -15.67, 35.62},
		{-2188.21, -70.00, 35.62},
		{-2254.33, -61.16, 35.62},
		{-2254.57, 11.85, 35.62},
		{-2252.38, 88.17, 35.62},
		{-2251.50, 164.36, 35.62},
		{-2251.39, 242.88, 35.62},
		{-2251.43, 322.06, 35.62},
		{-2290.05, 400.80, 35.47},
		{-2357.34, 477.06, 31.12},
		{-2287.46, 508.61, 35.50},
		{-2264.88, 614.11, 44.05},
		{-2264.94, 748.61, 49.81},
		{-2264.88, 892.21, 66.91},
		{-2264.81, 1013.76, 84.66},
		{-2264.47, 1072.97, 81.14},
		{-2263.62, 1095.95, 80.17},
	},
}

function finishLicense(value)
	if isElement(licenseMarker) and licenseMarker then
		destroyElement(licenseMarker)
		licenseMarker=nil
	end
	if isElement(licenseBlip) and licenseBlip then
		destroyElement(licenseBlip)
		licenseBlip=nil
	end
	if value == true then
		licenseCategory=nil
		licenseVehicle=nil
		licenseMarker=nil
		licenseTarget=nil
		licenseBlip=nil
	end
end
addEvent("license:finish",true)
addEventHandler("license:finish", resourceRoot, finishLicense)

function showMarker()
	local pos=categoryPositions[licenseCategory][licenseTarget]
	if licenseCategory ~= "L" then
	licenseMarker=createMarker(pos[1], pos[2], pos[3], "checkpoint", 1.5, 158,229,10, 155)
	else
	licenseMarker=createMarker(pos[1], pos[2], pos[3], "ring", 3.5, 255,0,0, 155)
	end
	licenseBlip=createBlip(pos[1], pos[2], pos[3], 0, 1.15, 0, 255, 0)
	if categoryPositions[licenseCategory][licenseTarget+1] then
  		e=categoryPositions[licenseCategory][licenseTarget+1]
		setMarkerTarget(licenseMarker, e[1], e[2], e[3])
	end
	addEventHandler("onClientMarkerHit", licenseMarker, function(el,md)
		if not md or el~=localPlayer then return end
		if not getPedOccupiedVehicle(el) then return end
		if licenseTarget < #categoryPositions[licenseCategory] then
			
			finishLicense(false)
			licenseTarget=licenseTarget+1
			showMarker()
		else
			outputChatBox("* Zdałeś(aś) egzamin. Gratulacje!")
			triggerServerEvent("license:vehdel", resourceRoot, licenseVehicle)
			setElementData(localPlayer,"player:license:pj"..licenseCategory, 1)
			finishLicense(true)
		end
	end)
end

addEvent("license:start",true)
addEventHandler("license:start", resourceRoot, function(category,vehicle)
	licenseTarget=1
	licenseBlip=nil
	licenseMarker=nil
	licenseCategory=category
	licenseVehicle=vehicle
	showMarker()
end)